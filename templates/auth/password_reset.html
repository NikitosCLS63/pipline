<!-- templates/auth/password_reset.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Восстановление пароля — SND</title>
  {% load static %}
  <link rel="stylesheet" href="{% static 'css/auth.css' %}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="{% static 'js/theme-toggle.js' %}"></script>
</head>
<body>
  <div class="auth-container">
    <div class="auth-header">
      <h1>Восстановление пароля</h1>
      <p>Введите email, и мы отправим ссылку</p>
    </div>
    <form id="reset-form">
      <div class="input-group">
        <input type="email" id="email" placeholder=" " required />
        <label for="email">Email</label>
        <i class="icon fas fa-envelope"></i>
        <div class="error-message"></div>
      </div>
      <button type="submit" class="auth-btn">
        <span class="btn-text">Отправить</span>
      </button>
      <!-- КНОПКА "НАЗАД" -->
      <div class="auth-footer">
        <a href="{% url 'login' %}" class="back-link">
          <i class="fas fa-arrow-left"></i> Назад ко входу</a>
      </div>

        <div class="message" id="message"></div>
      </div>
    </form>
    <div class="message" id="message"></div>
  </div>

  <script>
    document.getElementById('reset-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('email').value.trim();
      if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
        alert('Некорректный email');
        return;
      }
      const btn = document.querySelector('.auth-btn');
      btn.classList.add('loading');
      btn.querySelector('.btn-text').textContent = 'Отправляем...';

      try {
        const res = await fetch('/api/password_reset/', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email })
        });
        const data = await res.json();
        document.getElementById('message').textContent = data.success || data.error;
        document.getElementById('message').className = 'message show ' + (res.ok ? 'success' : 'error');
      } catch {
        alert('Ошибка сети');
      } finally {
        btn.classList.remove('loading');
        btn.querySelector('.btn-text').textContent = 'Отправить';
      }
    });
  </script>
</body>
<!-- ПЕРЕКЛЮЧАТЕЛЬ ТЕМЫ -->
<div class="theme-toggle" id="theme-toggle">
  <i class="fas fa-sun"></i>
</div>

<!-- ПОДКЛЮЧИ СКРИПТ -->
<script src="{% static 'js/theme-toggle.js' %}"></script>
</html>

